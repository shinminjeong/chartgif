{% load static %}
<html>
<head>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

  <link rel="stylesheet" href="{% static 'css/style.css' %}" />
  <title>Chartgif</title>
</head>
<body>
  <div>Chartgif -- World Life Expectancy vs Income</div>
  <div class="row">
    <div class="col-md-10">
      <div id="myChart"></div>
      <input type="range" class="slider" name="mySlider" id=mySlider min="1800" max="2018" value="1800"></input>
      <output for="foo" onforminput="value = foo.valueAsNumber;"></output>
    </div>
    <div class="col-md-2">
      Cluster information
      <div id="clusterinfo"></div>
    </div>
</body>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/d3-contour.v1.min.js"></script>
<script src="{% static 'js/scatter.js' %}"></script>
<script>
var gcolor = d3.scaleOrdinal(d3.schemeCategory10);

var data_plot = {{data|safe}};
var data_population = {{population|safe}};
var data_continent = {{continent|safe}};
var data_group = {{kgroup|safe}};
var cluster_info = {{clusterinfo|safe}};

var chart = new ScatterPlot("myChart");
chart.initChart(data_plot, data_population, data_continent, data_group);

var el, newPoint;
var infodiv = document.getElementById("clusterinfo");
function updateClusterinfo(year) {
  infodiv.innerHTML="<div>Year = " + year + "</div><br>";
  var numGroup = cluster_info["K"];
  var minmax = cluster_info["minmax"];

  for (var g = 0; g < numGroup; g++) {
    infodiv.innerHTML += "<div>"
    infodiv.innerHTML += "<span class='badge' style='background-color:"+gcolor(g)+"'>Group " + g + "</span><br>";
    infodiv.innerHTML += "X: " + minmax[g][year]["minx"] + "~" + minmax[g][year]["maxx"] + "<br>";
    infodiv.innerHTML += "Y: " + minmax[g][year]["miny"] + "~" + minmax[g][year]["maxy"] + "<br>";
    infodiv.innerHTML += "</div>"
  }
}

$('input[type=range]').on('input', function () {
  $(this).trigger('change');
});
$("input[type='range']").change(function() {
  el = $(this);
  width = el.width()-50;
  newPoint = (el.val() - el.attr("min")) / (el.attr("max") - el.attr("min"));
  // console.log(newPoint, el.val())
  el.next("output")
    .css({
     marginLeft: 10 + width * newPoint,
    })
    .text(el.val());
  chart.updateChart(el.val());

  updateClusterinfo(el.val());
})
// Fake a change to position bubble at page load
.trigger('change');
</script>
</html>
